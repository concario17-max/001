<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìº˜ë¦°ë” ë³€í™˜ê¸° V12 (ì—‘ìŠ¤ë ˆì´)</title>
    <style>
        body { background-color: #000000 !important; color: #ffffff !important; font-family: "Pretendard", sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { max-width: 500px; width: 100%; line-height: 1.6; }
        .box { background: white; padding: 40px; border-radius: 16px; max-width: 600px; margin: 0 auto; color: #333; }
        .badge { background: #2962ff; color: #fff; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; }
        button { background: #000000; color: white; border: none; padding: 16px 32px; font-size: 1.1rem; border-radius: 10px; cursor: pointer; width: 100%; font-weight: bold; }
        
        .version-tag { background: #2962ff; color: white; font-weight: bold; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; display: inline-block; margin-bottom: 20px; border: 2px solid white; }
        .title { font-size: 1.5rem; font-weight: bold; margin-bottom: 5px; color: #ffffff; border-left: 4px solid #4caf50; padding-left: 12px; }
        .description { font-size: 1.1rem; color: #eeeeee; white-space: pre-line; line-height: 1.8; }
        .img-box { margin-top: 15px; border-radius: 8px; overflow: hidden; margin-bottom: 15px; border: 1px solid #555; min-height: 50px; display: flex; align-items: center; justify-content: center; background: #111; }
        .img-box img { width: 100%; height: auto; display: block; }
        
        /* ì—‘ìŠ¤ë ˆì´ ë¡œê·¸ ìŠ¤íƒ€ì¼ */
        .xray-log { 
            background: #222; 
            border: 1px solid #444; 
            padding: 10px; 
            margin-bottom: 10px; 
            font-size: 0.85rem; 
            font-family: monospace; 
            color: #ddd; 
            border-radius: 5px;
        }
        .log-success { color: #00e676; font-weight: bold; }
        .log-fail { color: #ff5252; font-weight: bold; }
        .log-info { color: #40c4ff; }
    </style>
</head>
<body>
    <div class="container">
        <div class="version-tag">ğŸ•µï¸â€â™‚ï¸ V12 ì—‘ìŠ¤ë ˆì´ ì§„ë‹¨ì¤‘</div>
        <div class="date-label" id="date-display" style="color: #aaa; margin-bottom: 10px;"></div>
        <div id="content-area"></div>
    </div>

    <div id="converter-overlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 9999;">
        <div class="box">
            <h2>ğŸ•µï¸â€â™‚ï¸ V12 ì—‘ìŠ¤ë ˆì´ ë³€í™˜ê¸°</h2>
            <p>1. íŒŒì¼ì„ ì„ íƒí•˜ê³  ë³€í™˜í•˜ì„¸ìš”.<br>2. ë§Œë“¤ì–´ì§„ index.htmlì„ ê¹ƒí—ˆë¸Œì— ì˜¬ë¦¬ì„¸ìš”.</p>
            <input type="file" id="fileInput" multiple accept=".ics" style="margin: 20px 0;">
            <button id="convertBtn" onclick="processFiles()">ë³€í™˜ ë° ë‹¤ìš´ë¡œë“œ</button>
            <p style="font-size: 0.8rem; color: #666; margin-top: 10px;">(ë³€í™˜ í›„ ì´ ì°½ì€ ì‚¬ë¼ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œëœ íŒŒì¼ì„ ì“°ì„¸ìš”)</p>
        </div>
    </div>

<script>
    // â–¼â–¼â–¼ ë°ì´í„° ì²˜ë¦¬ ë¡œì§ â–¼â–¼â–¼
    const fileInput = document.getElementById('fileInput');

    async function processFiles() {
        const files = fileInput.files;
        if (files.length === 0) return alert("íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
        
        let allEvents = {};
        for (let file of files) {
            const text = await file.text();
            const events = parseICS(text);
            for (let dateKey in events) {
                if (allEvents[dateKey]) {
                    allEvents[dateKey].title += " <br> " + events[dateKey].title;
                    allEvents[dateKey].desc += "\n\n" + events[dateKey].desc; 
                } else {
                    allEvents[dateKey] = events[dateKey];
                }
            }
        }
        
        // ìµœì¢… HTML ìƒì„± ì‹œ ë®ì–´ì“°ê¸° ë¡œì§
        const finalHtml = generateFinalHTML(allEvents);
        downloadFile("index.html", finalHtml);
        alert("index.html ë‹¤ìš´ë¡œë“œ ì™„ë£Œ! ê¹ƒí—ˆë¸Œì— ì˜¬ë ¤ì£¼ì„¸ìš”.");
    }

    function parseDateStr(str) {
        if (!str || str.length < 8) return null;
        const y = parseInt(str.substring(0, 4));
        const m = parseInt(str.substring(4, 6)) - 1; 
        const d = parseInt(str.substring(6, 8));
        return new Date(y, m, d);
    }

    function parseICS(content) {
        const lines = content.split(/\r\n|\n|\r/);
        let events = {};
        let currentEvent = {};
        let inEvent = false;
        let unfoldedLines = [];
        for (let line of lines) {
            if (line.startsWith(' ')) { if (unfoldedLines.length > 0) unfoldedLines[unfoldedLines.length - 1] += line.substring(1); } 
            else { unfoldedLines.push(line.trim()); }
        }
        for (let line of unfoldedLines) {
            if (line.startsWith('BEGIN:VEVENT')) { inEvent = true; currentEvent = {}; continue; }
            if (line.startsWith('END:VEVENT')) {
                inEvent = false;
                if (currentEvent['DTSTART'] && currentEvent['SUMMARY']) {
                    let startRaw = currentEvent['DTSTART'].split(':')[1] || currentEvent['DTSTART'];
                    let endRaw = currentEvent['DTEND'] ? (currentEvent['DTEND'].split(':')[1] || currentEvent['DTEND']) : null;
                    let startDate = parseDateStr(startRaw);
                    let endDate = endRaw ? parseDateStr(endRaw) : new Date(startDate);
                    if (!endRaw) { endDate = new Date(startDate); endDate.setDate(endDate.getDate() + 1); }
                    
                    let title = currentEvent['SUMMARY'];
                    let desc = currentEvent['DESCRIPTION'] || '';
                    desc = desc.replace(/\\n/g, '\n').replace(/\\,/g, ',').replace(/\\;/g, ';');
                    
                    let loopDate = new Date(startDate);
                    while (loopDate < endDate) {
                        let key = `${loopDate.getMonth() + 1}-${loopDate.getDate()}`;
                        events[key] = { title: title, desc: desc };
                        loopDate.setDate(loopDate.getDate() + 1);
                        if ((loopDate - startDate) > 31536000000) break; 
                    }
                }
                continue;
            }
            if (inEvent) {
                let idx = line.indexOf(':');
                if (idx > -1) { currentEvent[line.substring(0, idx).split(';')[0]] = line.substring(idx + 1); }
            }
        }
        return events;
    }

    function generateFinalHTML(dailyData) {
        // ì‹¤ì œ ì‘ë™í•  ë•ŒëŠ” ì˜¤ë²„ë ˆì´(ë³€í™˜ê¸° í™”ë©´)ë¥¼ ìˆ¨ê¹ë‹ˆë‹¤.
        let jsonStr = "const dailyData = " + JSON.stringify(dailyData) + ";";
        
        // HTML ì½”ë“œë¥¼ ë¬¸ìì—´ë¡œ ë¦¬í„´
        return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ë©”ì‹œì§€ V12</title>
    <style>
        /* (ìœ„ìª½ ìŠ¤íƒ€ì¼ê³¼ ë™ì¼í•˜ê²Œ ë³µì‚¬ë¨) */
        body { background-color: #000000 !important; color: #ffffff !important; font-family: "Pretendard", sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
        .container { max-width: 500px; width: 100%; line-height: 1.6; }
        .version-tag { background: #2962ff; color: white; font-weight: bold; padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; display: inline-block; margin-bottom: 20px; border: 2px solid white; }
        .date-label { font-size: 1rem; color: #a0a0a0; margin-bottom: 5px; }
        .content-block { margin-bottom: 40px; border-bottom: 1px solid #333; padding-bottom: 30px; }
        .title { font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; color: #ffffff; border-left: 4px solid #4caf50; padding-left: 12px; }
        .description { font-size: 1.1rem; color: #eeeeee; white-space: pre-line; line-height: 1.8; }
        .img-box { margin-top: 15px; border-radius